package poly

import (
	"github.com/ethereum/go-ethereum/common/hexutil"
	//"github.com/palettechain/deploy-tool/config"
	//"github.com/stretchr/testify/assert"
	"testing"
)

func TestPolyClient_GetCurrentBlockHeight(t *testing.T) {
	//rpc := "http://106.75.226.11:40436"
	//configpath := "/Users/dylen/software/onRobot/build/target/config.json"
	//config.Init(configpath)
	//cli, err := NewPolyClient(rpc, nil)
	//assert.NoError(t, err)
	//
	//height, err := cli.GetCurrentBlockHeight()
	//assert.NoError(t, err)
	//
	//t.Logf("height %d", height)
}

func TestAssetTx(t *testing.T) {
	//headHex := "0x7b22706172656e7448617368223a22307861656364356331663130313132623662343539393033333236633034643266376166366436386535663665376337306438393062383365343339356137626161222c2273686133556e636c6573223a22307831646363346465386465633735643761616238356235363762366363643431616433313234353162393438613734313366306131343266643430643439333437222c226d696e6572223a22307830303030303030303030303030303030303030303030303030303030303030303030303030303030222c227374617465526f6f74223a22307865636465333237386664366262323061336165313935353965653539326631393335366334376331303065323061393138393364616464653161336132633731222c227472616e73616374696f6e73526f6f74223a22307832396634643530333562376433613739613833333834303634356264663632303333383761376339366537623133633434396533333063353538336532356666222c227265636569707473526f6f74223a22307862363434303864613662386665333961623736346166383865636531653863636131633335666439383864623537383036653939313338633632393336356130222c226c6f6773426c6f6f6d223a2230783030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030222c22646966666963756c7479223a22307831222c226e756d626572223a223078376235222c226761734c696d6974223a2230783861356439316666222c2267617355736564223a22307830222c2274696d657374616d70223a2230783631316239616132222c22657874726144617461223a2230786438383330313039303738343637363537343638383836373666333132653331333332653334383536633639366537353738303030303030303030303030303066393032326166383933393434363439363861666537313361663335306434633962336338333935643430343262346531383731393436653163313835636362613462613539356561303531336234646263396665323966613738326139393438303364643639643934313734316463616162646233643531323139313837373539363462316462393461646134613734633233646162346635653234633266316132333561386636353532393864323937393463316665633439306130646663323536316236353130393331343264386464343530303766313438393465333536313939316531643464323030633836653738316266616632316434653637306634326435393466346564386633663732323537623564653739343538393637313130653435616136663961323462623834313031636331623362666436613033356364633238363264396632363833383662396233363234633737646265626233313432653230326538633631663933646131316136316665633761613739303565343034333133306632623434623330316435316137333636386331623138396238373132366333616637336434663733303166393031346662383431653865666437346130636362663430613333306565643331346439643161633864376535646633343963396536393637386365396337363963393630386361363631323363316238323365653162373836363165613835616630323131393138353861626637343033353265313035343666633136306539353232346230643830316238343132343563653931356231366635363865323365363263383835323362653237623739323535313638336163643662306161343339653831396538346130396461356334323931363134666430383166366162646666333238613432313035366537303433383635353934663164396439373163613866336330396232646432333031623834313032356638633863386663336336323430303261383966393862353332353634363934656232356637303461326266663865363764326137643038306636663235663738663038646431666430363039666565336566316532616563396537356561343964323564346339303637663631623161366366353665636538336662303162383431623734643762656539363937633266393663396536663233383665323162663838656230666466393261326233353363363531643639626236613436356265353036383139383937343837353265383939353930386436353335366335656235663433363762613436333661313830373631306436633031666464303733633530306238343165323136313230376232363036666635663130323636616265336537663361643063666438663136393731303861323039336165386566623139653136363062353763613234616230393762396462393463303539353731373961383361393737376366343862623133626435336134313763663764373135643161616363333030222c226d697848617368223a22307836333734363936333631366332303632373937613631366537343639366536353230363636313735366337343230373436663663363537323631366536333635222c226e6f6e6365223a22307830303030303030303030303030303030222c2268617368223a22307837303433343662656534626438663139623539306163393162623063323832656139356633386362646532646366396136356537326130633162613832363739227d"
	//headerEnc, err  := hexutil.Decode(headHex)
	//if err != nil {
	//	t.Fatal(err)
	//}
	//
	rpc := "http://seed1.poly.network:20336"
	cli, err := NewPolyClient(rpc, nil)

	var hasValidatorsBlockNumber uint32 = 0
	gB, err := cli.GetBlockByHeight(hasValidatorsBlockNumber)
	if err != nil {
		t.Fatal(err)
		return
	}

	headerEnc := gB.Header.ToArray()
	headerHex := hexutil.Encode(headerEnc)
	t.Logf("header hex is %s", headerHex)

	bookeepers, err := GetBookeeper(gB)
	if err != nil {
		t.Fatal(err)
	}
	bookeepersEnc := AssembleNoCompressBookeeper(bookeepers)
	bookeepersHex := hexutil.Encode(bookeepersEnc)
	t.Logf("bookeepers hex %s", bookeepersHex)
}